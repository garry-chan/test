var solutions =
  {
    'dn02.a':
      {
        title: 'Chapter 2: Do-Now: Converting XHTML to HTML5',
        editDealing_solveFromSteps: 
          [
            'Atlanta\\sku02\\index.html',
            'Chicago\\sku02\\index.html',
            'London\\sku02\\index.html',
            'Los Angeles\\sku02\\index.html',
            'New York\\sku02\\index.html',
            'Ottawa\\sku02\\index.html',
            'Paris\\sku02\\index.html',
            'Stockholm\\sku02\\index.html',
            'Tokyo\\sku02\\index.html',
            'Toronto\\sku02\\index.html',
            'Washington\\sku02\\index.html'
          ]
      },
    'dn02.b':
      {
        title: 'Chapter 2: Do-Now: Converting Headers and Footers to HTML5',
        editDealing_solveFromSteps: 
          [
            'Atlanta\\sku02\\index.html',
            'Chicago\\sku02\\index.html',
            'London\\sku02\\index.html',
            'Los Angeles\\sku02\\index.html',
            'New York\\sku02\\index.html',
            'Ottawa\\sku02\\index.html',
            'Paris\\sku02\\index.html',
            'Stockholm\\sku02\\index.html',
            'Tokyo\\sku02\\index.html',
            'Toronto\\sku02\\index.html',
            'Washington\\sku02\\index.html'
          ]
      },
    'dn02.c':
      {
        title: 'Chapter 2: Do-Now: Compartmentalizing Content in HTML5',
        editDealing_solveFromSteps: 
          [
            'Atlanta\\sku02\\index.html',
            'Chicago\\sku02\\index.html',
            'London\\sku02\\index.html',
            'Los Angeles\\sku02\\index.html',
            'New York\\sku02\\index.html',
            'Ottawa\\sku02\\index.html',
            'Paris\\sku02\\index.html',
            'Stockholm\\sku02\\index.html',
            'Tokyo\\sku02\\index.html',
            'Toronto\\sku02\\index.html',
            'Washington\\sku02\\index.html'
          ]
      },
    'dn02.d':
      {
        title: 'Chapter 2: Do-Now: Converting Headings to HTML5',
        editDealing_solveFromSteps: 
          [
            'Atlanta\\sku02\\index.html',
            'Chicago\\sku02\\index.html',
            'London\\sku02\\index.html',
            'Los Angeles\\sku02\\index.html',
            'New York\\sku02\\index.html',
            'Ottawa\\sku02\\index.html',
            'Paris\\sku02\\index.html',
            'Stockholm\\sku02\\index.html',
            'Tokyo\\sku02\\index.html',
            'Toronto\\sku02\\index.html',
            'Washington\\sku02\\index.html'
          ]
      },
    'dn02.e':
      {
        title: 'Chapter 2: Do-Now: Completing the Conversion to HTML5 Semantic Elements',
        editDealing_solveFromSteps: 
          [
            'Atlanta\\sku02\\index.html',
            'Chicago\\sku02\\index.html',
            'London\\sku02\\index.html',
            'Los Angeles\\sku02\\index.html',
            'New York\\sku02\\index.html',
            'Ottawa\\sku02\\index.html',
            'Paris\\sku02\\index.html',
            'Stockholm\\sku02\\index.html',
            'Tokyo\\sku02\\index.html',
            'Toronto\\sku02\\index.html',
            'Washington\\sku02\\index.html'
          ]
      },
    'dn02.f':
      {
        title: 'Chapter 2: Do-Now: Supporting HTML5 Semantics in Legacy Browsers',
        editDealing_solveFromSteps: 
          [
            'Atlanta\\sku02\\index.html',
            'Chicago\\sku02\\index.html',
            'London\\sku02\\index.html',
            'Los Angeles\\sku02\\index.html',
            'New York\\sku02\\index.html',
            'Ottawa\\sku02\\index.html',
            'Paris\\sku02\\index.html',
            'Stockholm\\sku02\\index.html',
            'Tokyo\\sku02\\index.html',
            'Toronto\\sku02\\index.html',
            'Washington\\sku02\\index.html'
          ],
        viewDone_doNotSolve:
          [
            'css\\original.css'
          ]
      },
    'ex02.1':
      {
        title: 'Chapter 2: Self-Study Bonus Exercise 2.1: Annotating Page Elements With Microdata',
        editDealing_solveFromDone: 
          [
            'Atlanta\\sku05\\index.html',
            'Chicago\\sku05\\index.html',
            'London\\sku05\\index.html',
            'Los Angeles\\sku05\\index.html',
            'New York\\sku05\\index.html',
            'Ottawa\\sku05\\index.html',
            'Paris\\sku05\\index.html',
            'Stockholm\\sku05\\index.html',
            'Tokyo\\sku05\\index.html',
            'Toronto\\sku05\\index.html',
            'Washington\\sku05\\index.html'
          ]
      },
    'dn03.a':
      {
        title: 'Chapter 3: Do-Now: Adding New Attributes to Inputs',
        editDealing_solveFromSteps:
          [
            'join\\index.html'
          ]
      },
    'ex03.1':
      {
        title: 'Chapter 3: Exercise 3.1: Preventing User Errors with Form Validation',
        editDealing_solveFromDone: 
          [
            'css\\form-validation.css',
            'join\\index.html',
            'join\\INIT.js'
          ]
      },
    'ex04.1':
      {
        title: 'Chapter 4: Exercise 4.1: Delimiting Content With Enhanced Borders and Backgrounds',
        editDealing_solveFromDone: 
          [
            'css\\borders-etc.css'
          ]
      },
    'ex04.2':
      {
        title: 'Chapter 4: Exercise 4.2: Creating 3D Effects With Shadows and Opacity',
        editDealing_solveFromDone: 
          [
            'css\\3d-effects.css'
          ]
      },
    'ex04.3':
      {
        title: 'Chapter 4: Exercise 4.3: Advanced Styling With Attributes and Fonts',
        editDealing_solveFromDone: 
          [
            'css\\fonts-etc.css',
            'css\\stylesheet.css'
          ],
        noEdit_solveFromDone: 
          [
            'css\\gabrielle-webfont.eot',
            'css\\gabrielle-webfont.svg',
            'css\\gabrielle-webfont.ttf',
            'css\\gabrielle-webfont.woff'
          ]
      },
    'dn04.a':
      {
        title: 'Chapter 4: Do-Now: Optimizing Page Layout with Media Queries',
        viewDone_doNotSolve: 
          [
            'css\\media-queries.css'
          ]
      },
    'ex05.1':
      {
        title: 'Chapter 5: Exercise 5.1: Processing Market Selection on the Client',
        editDealing_solveFromSteps: 
          [
            'market-selection.js'
          ]
      },
    'ex05.2':
      {
        title: 'Chapter 5: Exercise 5.2: Storing Simple Data on the Client',
        editDealing_solveFromDone: 
          [
            'market-selection.js'
          ]
      },
    'ex05.3':
      {
        title: 'Chapter 5: Exercise 5.3: Persisting Complex Data as JSON',
        editDealing_solveFromDone: 
          [
            'deal-storage.js'
          ]
      },
    'ex06.1':
      {
        title: 'Chapter 6: Exercise 6.1: Working Offine',
        viewDone_doNotSolve:
          [
            'js\\appcache-management.js',
            'dealingtree.appcache'
          ]
      },
    'ex06.2':
      {
        title: 'Chapter 6: Exercise 6.2: Customizing the User Experience With Location-Specific Content',
        editDealing_solveFromDone: 
          [
            'market-geolocation.js'
          ],
        viewDealing_doNotSolve:
          [
            'haversine-miles.js'
          ]
      },
    'ex07.1':
      {
        title: 'Chapter 7: Exercise 7.1: Feature-Testing and Lazy-Loading with Modernizr',
        editDealing_solveFromDone: 
          [
            'add\\INIT.js'
          ],
        viewDealing_doNotSolve:
          [
            'add\\dropimage.js',
            'add\\editable.js'
          ]
      },
    'ex07.2':
      {
        title: 'Chapter 7: Exercise 7.2: Creating a Rich Text Editor',
        editDealing_solveFromDone: 
          [
            'add\\editable.js'
          ],
        editDealing_solveFromSteps:
          [
            'add\\index.html'
          ],
        viewDealing_doNotSolve:
          [
            'css\\page-add.css'
          ]
      },
    'ex07.3':
      {
        title: 'Chapter 7: Exercise 7.3: Simplifying File Upload With Drag-and-Drop',
        editDealing_solveFromDone: 
          [
            'add\\dropimage.js',
            'add\\index.html'
          ]
      },
    'ex07.4':
      {
        title: 'Chapter 7: Self-Study Bonus Exercise 7.4: Purchasing Deals with Drag-and-Drop',
        editDealing_solveFromDone: 
          [
            'deal-dragndrop.js'
          ]
      },
    'ex08.1':
      {
        title: 'Chapter 8: Exercise 8.1: Synchronizing Windows With Messages',
        viewDealing_doNotSolve: 
          [
            'help\\message-with-main.js',
            'js\\message-with-help.js'
          ]
      },
    'ex08.2':
      {
        title: 'Chapter 8: Exercise 8.2: Including Third-Party Data Using CORS',
        viewDealing_doNotSolve:
          [
            'chirps\\chirps-from-cors.js',
            'chirps\\chirps-to-html5.js',
            'chirps\\chirps-referral.js',
            'chirps\\INIT.js'
          ]
      },
    'ex08.3':
      {
        title: 'Chapter 8: Exercise 8.3: Pushing Data to the Client With WebSockets',
        viewDone_doNotSolve:
          [
            'websockets-counter.js'
          ]
      },
    'ex08.4':
      {
        title: 'Chapter 8: Exercise 8.4: Executing Code in a Web Worker',
         viewDone_doNotSolve:
          [
            'cloud-data.txt',
            'tags-builder.js',
            'tags-launcher.js',
            'tags-worker.js',
            'tags-data-to-html.js'
          ]
     },
    'ex09.1':
      {
        title: 'Chapter 9: Exercise 9.1: Graphing User Savings With Canvas',
        editDealing_solveFromDone: 
          [
            'savings\\index.html'
          ],
        editDealing_solveFromSteps:
          [
            'savings\\savings-canvas.js'
          ]
      },
    'dn09.a':
      {
        title: 'Chapter 9: Do-Now: Placing Images on a Chart',
        editDealing_solveFromDone: 
          [
            'savings\\index.html'
          ],
        editDealing_solveFromSteps:
          [
            'savings\\savings-canvas.js'
          ]
      },
    'ex09.2':
      {
        title: 'Chapter 9: Exercise 9.2: Adding Text to a Canvas',
        editDealing_solveFromDone: 
          [
            'savings\\index.html',
            'savings\\savings-canvas.js'
          ],
         viewDealing_doNotSolve:
          [
            'savings\\canvastext.txt'
          ]
      },
    'ex09.3':
      {
        title: 'Chapter 9: Exercise 9.3: Upgrading Site Graphics to SVG',
        editDealing_solveFromDone: 
          [
            'css\\svg-backgrounds.css',
            'images\\arrow-up.svg'
          ],
         viewDealing_doNotSolve:
          [
            'images\\tree-graphic.svg',
            'savings\\INIT.js',
            'savings\\savings-canvas.js',
            'savings\\savings-svg.js'
          ]
      },
    'dn10.a':
      {
        title: 'Chapter 10: Do-Now: Embedding Audio in a Web Page',
        editDealing_solveFromSteps:
          [
            'chirps\\index.html'
          ]
      },
    'dn10.b':
      {
        title: 'Chapter 10: Do-Now: Providing a Choice of Sources',
        editDealing_solveFromDone:
          [
            'chirps\\index.html'
          ]
      },
    'ex10.1':
      {
        title: 'Chapter 10: Exercise 10.1: Promoting Web Site Features With Video',
        editDealing_solveFromDone: 
          [
            'demo\\index.html'
          ],
        noEdit_solveFromDone:
          [
            'demo\\demo.ogv',
            'demo\\demo.webm'
          ],
      }
  };

var editors =
  [
    { name: 'Komodo', exe: 'C:\\Program Files (x86)\\ActiveState Komodo Edit 6\\komodo.exe' },
    { name: 'Notepad++', exe: 'C:\\Program Files (x86)\\Notepad++\\notepad++.exe' },
    { name: 'VWDExpress', exe: 'C:\\Program Files (x86)\\Microsoft Visual Studio 10.0\\Common7\\IDE\\VWDExpress.exe' }
  ];

//----------------------------------------------------------------------
// If viewDone == true, use the solution file.

function CreateEditLinks(listing,file,viewDone)
{
  var longName = ( viewDone ? 'done-deal\\' : '' ) + file;
  var item = $('<li><img src="images/icon-doc-'
                + file.substring(1+file.lastIndexOf('.'))
                + '.png" />&nbsp;<kbd>'
                + longName + '</kbd></li>' );

  var inserted = false; 
  $('li',listing).each(
    function()
    {
      if ( ( ! inserted ) && ( longName < $('kbd',this).text() ) )
      {
        item.insertBefore(this);
        inserted = true;
      }
    });
  if ( ! inserted )
    listing.append(item);

  for ( var i = 0 ; i < editors.length ; i++ )
  {
    (function(){
      var i2 = i;
      $('<a class="editLink" href="javascript:void" title="'
          + editors[i].name
          + '"><img src="images/icon-edit-'+i+'.png" alt="'
          + editors[i].name+'" /></a>' )
        .click(
          function(e)
          {
            var cmd = '"' + editors[i2].exe + '" "C:\\2320\\'
                  + (viewDone ? 'done-deal' : 'dealingtree' )
                  + '\\' + file + '"';
            try
            {
              var sh = new ActiveXObject("WScript.Shell");
              sh.Run(cmd,1);
            }
            catch(e)
            {
              alert(cmd+'\n\n'+e.message+'\n\n'+String(e));
            }
            e.preventDefault();
          } )
        .appendTo( item );
    })();
  }
}

//----------------------------------------------------------------------

$(function()
{
  var i;
  var article = $('article');

  for ( var key in solutions )
    (function()
    {
      var key2 = key;
      var sol = solutions[key2];

      var list = $('<ul/>');

      article.append(
        $('<section><h1><a href="javascript:void()">'
            + sol.title+'</a></h1></section>')
          .append( 
            $( '<div></div>' )
              .append(list)
            )
        );

      files = sol.viewDealing_doNotSolve;
      if ( files )
        for ( i = 0 ; i < files.length ; i++ )
          CreateEditLinks(list,files[i],false);

      var files = sol.editDealing_solveFromDone;
      if ( files )
        for ( i = 0 ; i < files.length ; i++ )
            CreateEditLinks(list,files[i],false);

      files = sol.editDealing_solveFromSteps;
      if ( files )
        for ( i = 0 ; i < files.length ; i++ )
          CreateEditLinks(list,files[i],false);

      files = sol.viewDone_doNotSolve;
      if ( files )
        for ( i = 0 ; i < files.length ; i++ )
          CreateEditLinks(list,files[i],true);

      list.append(
        $('<li><img src="images/icon-check.png" />&nbsp;</li>' )
          .append( 
            $('<a href="javascript:void();" title="replace exercise files with solutions">solve</a>')
              .click(
                function(e)
                {
                  e.preventDefault();
                  if ( confirm( 'Are you sure that you want to overwrite the '+sol.title
                        +' files with the solution?\n\nThis action cannot be undone!') )
                  {
                    var commands = '@ECHO OFF\nECHO Solving '+sol.title+':\n';

                    var files = sol.editDealing_solveFromDone;
                    if ( files )
                      for ( var i = 0 ; i < files.length ; i++ )
                      {
                        commands += 'ECHO .\nECHO '+files[i]+' :\n';
                        commands += 'COPY /Y "c:\\2320\\done-deal\\'+files[i]+'" "c:\\2320\\dealingtree\\'+files[i]+'"\n';
                      }

                    var files = sol.noEdit_solveFromDone;
                    if ( files )
                      for ( var i = 0 ; i < files.length ; i++ )
                      {
                        commands += 'ECHO .\nECHO '+files[i]+' :\n';
                        commands += 'COPY /Y "c:\\2320\\done-deal\\'+files[i]+'" "c:\\2320\\dealingtree\\'+files[i]+'"\n';
                      }

                    files = sol.editDealing_solveFromSteps;
                    if ( files )
                      for ( i = 0 ; i < files.length ; i++ )
                      {
                        commands += 'ECHO .\nECHO '+files[i]+' :\n';
                        commands += 'COPY /Y "c:\\2320\\exercise-explorer\\steps\\'+key2+'\\'+files[i]+'" "c:\\2320\\dealingtree\\'+files[i]+'"\n';
                      }

                    commands += 'EXIT\n';
                    try
                    {
                      var sh = new ActiveXObject("WScript.Shell");
                      var cmd = sh.Exec("cmd.exe /Q");
                      cmd.StdIn.Write( commands );
                      var result = "";
                      while ( ! cmd.StdOut.AtEndOfStream )
                        if ( cmd.StdOut.Read(1) == '>' )
                          break;
                      while ( ! cmd.StdOut.AtEndOfStream )
                        result += cmd.StdOut.Read(1);
                      alert(result);
                    }
                    catch ( e )
                    {
                      alert('WARNING! Error while solving '+sol.title+': '+e.message);
                    }
                  } // if ( confirm( ... )
                }) // .click(...)
            )
        ) // list.append(...)
    })();

  article.accordion( {
    active: 'section:last-child h1',
    autoHeight: false,
    collapsible: true,
    header: 'h1',
    icons:
      {
        header: 'ui-icon-folder-collapsed',
        headerSelected: 'ui-icon-folder-open'
      }
    });

});
// END
